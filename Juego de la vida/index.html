<!DOCTYPE html>
<head>
    <title>Game of life</title>
    <link href="styles.css" rel="stylesheet">
</head>
<body>    
    <div class="controls">
        Choose grid size:
        <input type="radio" name="gridSize" title="25columns" value="25" checked> 25 X 20
        <input type="radio" name="gridSize" title="50columns" value="50"> 50 X 50   
                
        <button>Create grid</button>

        <button id="start">Start game</button>
    </div>
    <header>The Game of Life</header>
    <div id="grid"></div>
    

    <script>       
        var grid = [];         
        var rows;
        var columns;

        var botones = document.getElementsByTagName("button")[0].addEventListener("click",function(e){            
            var row;
            var divRow;
            var divCell;                                     

            var gridSize = document.getElementsByName("gridSize");                        
            for (var i = 0; i < gridSize.length; i++) {
                if (gridSize[i].checked) {
                    rows = parseInt(gridSize[i].value);
                    columns = rows;
                    break;
                }
            }

            for (var i = 0; i < rows; i++) {
                row = [];
                divRow = document.createElement("div");
                divRow.classList.add("row");
                
                for (var j=0; j < columns; j++) {                    
                    row.push(0);

                    divCell = document.createElement("div");
                    divCell.classList.add("cell");
                    divCell.setAttribute("row",i);
                    divCell.setAttribute("column",j);
                    divRow.appendChild(divCell);

                }
                grid.push(row);                
                document.getElementById("grid").appendChild(divRow);
            }   
                        
            var cells = document.getElementsByClassName("cell");
            for (var k=0; k < cells.length; k++) {
                cells[k].addEventListener("click", function(e){                    
                    var row = parseInt(e.target.getAttribute("row"));
                    var column = parseInt(e.target.getAttribute("column"));

                    if (grid[row][column]) {
                        e.target.classList.remove("alive");
                        grid[row][column] = 0;                        
                    }
                    else {
                        e.target.classList.add("alive");
                        grid[row][column] = 1;                                               
                    }                       
                });                     
            }                                                                  
        });

        document.getElementById("start").addEventListener("click",function(e){
            setInterval(nextStep,1000);            
        });

        function nextStep () {
            var fPrev;            
            var fNext;
            var cPrev;
            var cNext;
            var cNext
            var aux = "";                                                
 
            for (var f = 0; f < rows; f++) {
                for (var c = 0; c < columns; c ++) {
                    /* 
                        Veo las coordenadas de los vecinos.  
                        Tomar en cuenta que el mundo es en forma de dona y hay que manejar condiciones de borde
                    */                   
                    fPrev = ((f - 1) == -1)?rows-1:f-1;            
                    fNext = ((f + 1) == rows)?0:f+1;
                    cPrev = ((c - 1) == -1)?columns-1:c-1;
                    cNext = ((c + 1) == columns)?0:c + 1;
                    
                    // Reviso cuantos vecinos estÃ¡n prendidos
                    numNeighbors = grid[fPrev][cPrev] + grid[fPrev][c] + grid[fPrev][cNext];
                    numNeighbors += grid[f][cPrev] + grid[f][cNext];
                    numNeighbors += grid[fNext][cPrev] + grid[fNext][c] + grid[fNext][cNext];
                                                                                                                                            
                    aux = 'div[row="' + f + '"][column="' + c + '"]';
                    document.querySelector(aux).classList.remove("alive");
                    if (grid[f][c] > 0) {
                        if ((numNeighbors == 2) || (numNeighbors == 3)) {
                            document.querySelector(aux).classList.add("alive");
                        }                        
                    } 
                    else {
                        if (numNeighbors == 3) {
                            document.querySelector(aux).classList.add("alive");
                        }                        
                    }                                                           
                }                
            }
                        
            for (var f = 0; f < rows; f ++) {
                for (var c = 0; c < columns; c ++) {                    
                    aux = 'div[row="' + f + '"][column="' + c + '"]';                    
                    grid[f][c] = 0;
                    if (document.querySelector(aux).classList.contains("alive")) {
                        grid[f][c] = 1;
                    }                    
                }
            }                                    
        }
    </script>
</body>